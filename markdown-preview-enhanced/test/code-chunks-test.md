# Markdown Preview Enhanced - Code Chunk  
From version `0.9.9`, markdown-preview-enhanced (mpe) made code chunk even more powerful.  
This `html` file is generated by markdown-preview-enhanced.   
*Could be buggy though :(*

<!-- toc orderedList:0 depthFrom:2 depthTo:6 -->

* [Commands & Keyboard Shortcust](#commands-keyboard-shortcust)
* [node.js](#nodejs)
* [Python matplotlib](#python-matplotlib)
  * [mpld3 interactive graphs](#mpld3-interactive-graphs)
* [browser javascript](#browser-javascript)
  * [Chart.js](#chartjs)
  * [Plotly](#plotly)

<!-- tocstop -->


## Commands & Keyboard Shortcust
* `Markdown Preview Enhanced: Run Code Chunk` or <kbd>shift-enter</kbd>      
execute single code chunk where your cursor is at.    
* `Markdown Preview Enhanced: Run All Code Chunks` or <kbd>ctrl-shift-enter</kbd>   
execute all code chunks.    

Or you can just click the `run` button in preview.  

## node.js
```{javascript cmd:"node", id:"izape715"}
// ```{javascript cmd:"node"}
console.log("Hello Markdown Preview Enhanced - " + new Date())
```

## Python matplotlib

You can set `matplotlib: true` or `mpl: true` to configure matplotlib to show figures embeded in preview.    
For example:  

```{python matplotlib:true, id:"izdlqdtc"}
# ```{python matplotlib:true, id:"izdlqdtc"}
import matplotlib
import matplotlib.pyplot as plt
import numpy as np
```

```{python continue: true, id:"izbp0zt9"}
# ```{python continue: true, id:"izbp0zt9"}
# `continue: true` here means this code chunk will continue from last one
plt.plot([1,2,3, 4])
plt.show() # show figure
```

```{python continue:'izdlqdtc', id:"izc8i56g"}
# ```{python continue:'izdlqdtc', id:"izc8i56g"}
# `continue:'izdlqdtc'` here means this code chunk will continue from the
# code chunk of id `izdlqdtc`, which is the last last one.  
from mpl_toolkits.mplot3d import Axes3D
def randrange(n, vmin, vmax):
    '''
    Helper function to make an array of random numbers having shape (n, )
    with each number distributed Uniform(vmin, vmax).
    '''
    return (vmax - vmin)*np.random.rand(n) + vmin

fig = plt.figure()
ax = fig.add_subplot(111, projection='3d')

n = 100

# For each set of style and range settings, plot n random points in the box
# defined by x in [23, 32], y in [0, 100], z in [zlow, zhigh].
for c, m, zlow, zhigh in [('r', 'o', -50, -25), ('b', '^', -30, -5)]:
    xs = randrange(n, 23, 32)
    ys = randrange(n, 0, 100)
    zs = randrange(n, zlow, zhigh)
    ax.scatter(xs, ys, zs, c=c, marker=m)

ax.set_xlabel('X Label')
ax.set_ylabel('Y Label')
ax.set_zlabel('Z Label')

plt.show()
```

```{python continue:'izdlqdtc', id:"izd4inyh"}
# ```{python continue:'izdlqdtc', id:"izd4inyh"}
import pandas as pd
import seaborn as sns

ts = pd.Series(np.random.randn(1000), index=pd.date_range('1/1/2000', periods=1000))
ts = ts.cumsum()

df = pd.DataFrame(np.random.randn(1000, 4), index=ts.index,
                  columns=['A', 'B', 'C', 'D'])
df = df.cumsum()
df.plot();
plt.legend(loc='best')
plt.show()
```

### mpld3 interactive graphs  
**mpe** also supports matplotlib interactive graphs rendered by [mpld3](https://mpld3.github.io/).  
*however: it doesn't work with pandoc and markdown export. HTML export requires internet connection.*  

```{python matplotlib:true, id:"izcdmeop"}
# ```{python matplotlib:true, id:"izcdmeop"}
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import mpld3
from mpld3 import plugins
np.random.seed(9615)

# generate df
N = 100
df = pd.DataFrame((.1 * (np.random.random((N, 5)) - .5)).cumsum(0),
                  columns=['a', 'b', 'c', 'd', 'e'],)

# plot line + confidence interval
fig, ax = plt.subplots()
ax.grid(True, alpha=0.3)

for key, val in df.iteritems():
    l, = ax.plot(val.index, val.values, label=key)
    ax.fill_between(val.index,
                    val.values * .5, val.values * 1.5,
                    color=l.get_color(), alpha=.4)

# define interactive legend

handles, labels = ax.get_legend_handles_labels() # return lines and labels
interactive_legend = plugins.InteractiveLegendPlugin(zip(handles,
                                                         ax.collections),
                                                     labels,
                                                     alpha_unsel=0.5,
                                                     alpha_over=1.5,
                                                     start_visible=True)
plugins.connect(fig, interactive_legend)

ax.set_xlabel('x')
ax.set_ylabel('y')
ax.set_title('Interactive legend', size=20)

mpld3.show() # show mpld3 interactive graph  
```

```{python matplotlib: true, id:"izcgdsnn"}
# ```{python matplotlib: true, id:"izcgdsnn"}
import numpy as np
import matplotlib.pyplot as plt
import matplotlib as mpl

import mpld3
from mpld3 import plugins, utils


class DragPlugin(plugins.PluginBase):
    JAVASCRIPT = r"""
    mpld3.register_plugin("drag", DragPlugin);
    DragPlugin.prototype = Object.create(mpld3.Plugin.prototype);
    DragPlugin.prototype.constructor = DragPlugin;
    DragPlugin.prototype.requiredProps = ["id"];
    DragPlugin.prototype.defaultProps = {}
    function DragPlugin(fig, props){
        mpld3.Plugin.call(this, fig, props);
        mpld3.insert_css("#" + fig.figid + " path.dragging",
                         {"fill-opacity": "1.0 !important",
                          "stroke-opacity": "1.0 !important"});
    };

    DragPlugin.prototype.draw = function(){
        var obj = mpld3.get_element(this.props.id);

        var drag = d3.behavior.drag()
            .origin(function(d) { return {x:obj.ax.x(d[0]),
                                          y:obj.ax.y(d[1])}; })
            .on("dragstart", dragstarted)
            .on("drag", dragged)
            .on("dragend", dragended);

        obj.elements()
           .data(obj.offsets)
           .style("cursor", "default")
           .call(drag);

        function dragstarted(d) {
          d3.event.sourceEvent.stopPropagation();
          d3.select(this).classed("dragging", true);
        }

        function dragged(d, i) {
          d[0] = obj.ax.x.invert(d3.event.x);
          d[1] = obj.ax.y.invert(d3.event.y);
          d3.select(this)
            .attr("transform", "translate(" + [d3.event.x,d3.event.y] + ")");
        }

        function dragended(d) {
          d3.select(this).classed("dragging", false);
        }
    }
    """

    def __init__(self, points):
        if isinstance(points, mpl.lines.Line2D):
            suffix = "pts"
        else:
            suffix = None

        self.dict_ = {"type": "drag",
                      "id": utils.get_id(points, suffix)}


fig, ax = plt.subplots()
np.random.seed(0)
points = ax.plot(np.random.normal(size=20),
                 np.random.normal(size=20), 'or', alpha=0.5,
                 markersize=50, markeredgewidth=1)
ax.set_title("Click and Drag", fontsize=18)

plugins.connect(fig, DragPlugin(points[0]))

mpld3.show()
```

## browser javascript  
From version `0.9.9`, markdown-preview-enhanced adds support of browser javascript code chunk.   
You can set `element` option to indicate what element to append for your code chunk.  
You can set `require` option to require external javascript files, both local and remote are supported.    
*However, browser javascript is unsafe and might cause security issue.*  
Below are some examples   
### Chart.js  
```{javascript output:"markdown", element:'<canvas id="myChart" width="400" height="400"></canvas>', id:"izap3ln0", require: ["https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.min.js"]}
// ```{javascript output:"markdown", element:'<canvas id="myChart" width="400" height="400"></canvas>', id:"izap3ln0", require: ["https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.min.js"]}
var ctx = document.getElementById("myChart");
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
        datasets: [{
            label: '# of Votes',
            data: [12, 19, 3, 5, 2, 3],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    }
});
```

### Plotly
*Plotly works buggy sometimes on mpe*    
```{javascript id:"izbr5wl4", element:"<div id=\"tester\"></div>", require: ["https://cdn.plot.ly/plotly-latest.min.js"]}
// ```{javascript id:"izbr5wl4", element:"<div id=\"tester\"></div>", require: ["https://cdn.plot.ly/plotly-latest.min.js"]}
TESTER = document.getElementById('tester');
Plotly.plot( TESTER, [{
x: [1, 2, 3, 4, 5],
y: [1, 2, 4, 8, 16] }], {

margin: { t: 0 } } );
''
```

```{javascript id:"izd9m66j", element:"<div id=\"tester2\"></div>", require: ["https://cdn.plot.ly/plotly-latest.min.js"]}
// ```{javascript id:"izd9m66j", element:"<div id=\"tester2\"></div>", require: ["https://cdn.plot.ly/plotly-latest.min.js"]}
var data = [{
  values: [19, 26, 55],
  labels: ['Residential', 'Non-Residential', 'Utility'],
  type: 'pie'
}];

var layout = {
  height: 400,
  width: 500
};

Plotly.newPlot('tester2', data, layout);
''
```